<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Fahrzeugübersicht</title>
<style>
body { margin: 0; font-family: "Segoe UI", Arial, sans-serif; background: transparent; color: #fff; }
.container { max-width: 1800px; margin: 50px auto; padding: 20px; }
.title { text-align: center; font-size: 36px; letter-spacing: 3px; margin-bottom: 40px; position: relative; }
.title::after { content: ""; width: 120px; height: 2px; background: #4aa3ff; display: block; margin: 15px auto 0; }
.grid { display: grid; grid-template-columns: repeat(4, 400px); gap: 30px; justify-content: center; }
.card { width: 400px; height: 380px; background: linear-gradient(180deg, #142c46, #0e2136); border-radius: 14px; overflow: hidden; border: 2px solid transparent; box-shadow: 0 15px 30px rgba(0,0,0,0.4); transition: transform 0.3s ease, box-shadow 0.3s ease; }
.card:hover { transform: translateY(-8px); animation: policeBorder 0.8s infinite alternate; }
.card img { width: 100%; height: 250px; object-fit: cover; }
.card-content { padding: 5px 10px; text-align: center; height: 70px; box-sizing: border-box; display: flex; flex-direction: column; justify-content: center; }
.card-title { font-size: 18px; font-weight: 600; margin-bottom: 2px; }
.card-subtitle { font-size: 14px; color: #9cc9ff; }
.card-description { color: #cccccc; margin-top: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
footer { text-align: center; margin: 50px 0 20px; font-size: 13px; opacity: 0.6; }
@keyframes policeBorder { 0% { border-color: #1e90ff; box-shadow:0 0 10px rgba(30,144,255,0.8);} 100% { border-color: #ff3b3b; box-shadow:0 0 10px rgba(255,59,59,0.8);} }
#adminPanel,#adminRemovePanel,#adminPlusPanel { max-width:1200px;margin:20px auto;padding:20px;background:#0b1f35;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,0.3);}
#adminPanel input,#adminPanel select,#adminRemovePanel input,#adminRemovePanel select,#adminRemovePanel button,#adminPanel button { padding:6px;margin:5px;border-radius:5px;border:none; }
#adminPanel button,#adminRemovePanel button { background-color:#4aa3ff;color:white;cursor:pointer; }
#adminPanel button:hover,#adminRemovePanel button:hover { background-color:#1e90ff; }
#codeInput,#logCodeInput { max-width:300px;margin:20px auto;display:flex;justify-content:center; }
#codeInput input,#logCodeInput input { padding:6px;border-radius:5px;border:none;margin-right:5px; }
#codeInput button,#logCodeInput button { padding:6px 12px;border:none;border-radius:5px;background-color:#4aa3ff;color:white;cursor:pointer; }
#codeInput button:hover,#logCodeInput button:hover { background-color:#1e90ff; }
#adminPlusPanel { opacity:0; transform:translateY(-20px); transition:opacity 0.5s ease,transform 0.5s ease; display:none; }
#adminPlusPanel.show { display:block; opacity:1; transform:translateY(0); }
#adminPlusPanel ul { list-style:none;padding-left:0;color:#fff; }
#adminPlusPanel li { padding:5px 0; }
#adminPlusPanel button { padding:6px 12px;border-radius:5px;border:none;cursor:pointer;color:white;background-color:#ff4c4c;margin-top:10px;}
#adminPlusPanel button:hover { background-color:#e63939; }
</style>
</head>
<body>

<div id="vehiclesContainer"></div>

<div id="codeInput">
<input type="password" id="adminCode" placeholder="Admin Code">
<button onclick="checkCode()">Eingeben</button>
</div>

<div id="logCodeInput">
<input type="password" id="logCode" placeholder="Log Code">
<button onclick="checkLogCode()">Eingeben</button>
</div>

<div id="adminRemovePanel" style="display:none;">
<h3>Fahrzeug entfernen</h3>
<label>Wer entfernt das Fahrzeug? *<input type="text" id="removedBy" placeholder="Dein Name"></label><br>
<select id="removeCategory" onchange="updateRemoveVehicles()">
<option value="">Kategorie wählen</option>
<option value="Officer I">Officer I</option>
<option value="Officer II">Officer II</option>
<option value="Officer III">Officer III</option>
<option value="Officer III+1">Officer III+1</option>
<option value="Detective">Detective</option>
<option value="Sonstiges">Sonstiges</option>
</select>
<select id="removeVehicle"><option value="">Fahrzeug wählen</option></select>
<button onclick="removeVehicle()">Entfernen</button>
</div>

<div id="adminPanel" style="display:none;">
<h2>Admin Panel</h2>
<input type="text" id="vehicleName" placeholder="Fahrzeugname">
<input type="text" id="vehicleYear" placeholder="Baujahr">
<input type="text" id="vehicleDescription" placeholder="Beschreibung">
<input type="text" id="vehicleImage" placeholder="Bild-URL">
<select id="vehicleCategory">
<option value="Officer I">Officer I</option>
<option value="Officer II">Officer II</option>
<option value="Officer III">Officer III</option>
<option value="Officer III+1">Officer III+1</option>
<option value="Detective">Detective</option>
<option value="Sonstiges">Sonstiges</option>
</select>
<button onclick="addVehicle()">Hinzufügen</button>
</div>

<div id="adminPlusPanel">
<h2>Versionsverlauf</h2>
<ul id="adminLog"></ul>
<button onclick="clearAdminLog()">Versionsverlauf löschen</button>
</div>

<footer>© Hashikeks#0</footer>

<script>
// ------------------- CONFIG -------------------
const ADMIN_PASSWORD = "Leitung2026";
const LOG_PASSWORD = "Walker77";

const GITHUB_USER = "Hashikeks";
const GITHUB_REPO = "Fahrzeuge";
const GITHUB_BRANCH = "main";
const VEHICLES_FILE = "vehiclesData.json";
const LOG_FILE = "adminLog.json";
const GITHUB_TOKEN = "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";
const LOCAL_MODE = true;
// ---------------------------------------------

let vehiclesData = {};
let vehiclesSHA = null;
let adminLog = [];
let logSHA = null;

// ------------------- HELPER FUNCTIONS -------------------
function renderVehicles() {
    const container = document.getElementById("vehiclesContainer");
    container.innerHTML = "";
    for (const cat in vehiclesData) {
        if (!vehiclesData[cat] || vehiclesData[cat].length === 0) continue;
        const section = document.createElement("div"); section.classList.add("container");
        const title = document.createElement("div"); title.classList.add("title"); title.textContent = `— ${cat} —`; section.appendChild(title);
        const grid = document.createElement("div"); grid.classList.add("grid");
        vehiclesData[cat].forEach(v => {
            const card = document.createElement("div"); card.classList.add("card");
            card.innerHTML = `<img src="${v.img}"><div class="card-content"><div class="card-title">${v.name}</div><div class="card-subtitle">${v.year}</div>${v.description ? `<div class="card-description">${v.description}</div>` : ""}</div>`;
            grid.appendChild(card);
        });
        section.appendChild(grid); container.appendChild(section);
    }
}

function updateAdminLog() {
    const ul = document.getElementById("adminLog"); ul.innerHTML = "";
    adminLog.slice().reverse().forEach(e => {
        const li = document.createElement("li");
        li.innerHTML = `<strong>${e.name}</strong> wurde <em>${e.action}</em> von <strong>${e.by}</strong> in Kategorie <strong>${e.category}</strong> am ${new Date(e.timestamp).toLocaleString()}`;
        ul.appendChild(li);
    });
}

async function loadVehicles() {
    if (LOCAL_MODE) return;
    const res = await fetch(
        `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${VEHICLES_FILE}?ref=${GITHUB_BRANCH}`,
        { headers: { Authorization: `token ${GITHUB_TOKEN}` } }
    );
    const json = await res.json();
    if (!json.content) { vehiclesData = {}; return; }
    vehiclesSHA = json.sha;
    vehiclesData = JSON.parse(atob(json.content) || "{}");
    renderVehicles();
    updateRemoveVehicles();
}

async function loadLog() {
    if (LOCAL_MODE) { 
        fetch(LOG_FILE).then(res=>res.json()).then(data=>{ adminLog=data; updateAdminLog(); }); 
    } else { 
        const res = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${LOG_FILE}`);
        const json = await res.json(); 
        adminLog = JSON.parse(atob(json.content)); 
        logSHA = json.sha; 
        updateAdminLog(); 
    }
}

async function saveVehiclesGitHub(message = "Update Fahrzeuge") {
    if (!vehiclesSHA) { alert("SHA fehlt – bitte Seite neu laden"); return; }
    const body = {
        message,
        content: btoa(JSON.stringify(vehiclesData, null, 2)),
        branch: GITHUB_BRANCH,
        sha: vehiclesSHA
    };
    const res = await fetch(
        `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${VEHICLES_FILE}`,
        { method: "PUT", headers: { Authorization: `token ${GITHUB_TOKEN}`, "Content-Type": "application/json" }, body: JSON.stringify(body) }
    );
    const json = await res.json();
    if (!json.content || !json.content.sha) { console.error("GitHub Save Error:", json); alert("Fehler beim Speichern auf GitHub. Siehe Console."); return; }
    vehiclesSHA = json.content.sha;
}

async function saveLogGitHub(message="Update Log") {
    if (!logSHA && !LOCAL_MODE) { alert("Log SHA fehlt!"); return; }
    const body = { message, content: btoa(JSON.stringify(adminLog,null,2)), branch: GITHUB_BRANCH, sha: logSHA };
    if (!LOCAL_MODE) {
        const res = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${LOG_FILE}`, { method:"PUT", headers:{"Authorization":`token ${GITHUB_TOKEN}`,"Content-Type":"application/json"}, body:JSON.stringify(body) });
        const json = await res.json(); 
        logSHA = json.content.sha;
    }
}

// ------------------- ADMIN FUNCTIONS -------------------
window.checkCode = function() {
    if (document.getElementById("adminCode").value===ADMIN_PASSWORD) {
        document.getElementById("adminPanel").style.display="block";
        document.getElementById("adminRemovePanel").style.display="block";
        document.getElementById("codeInput").style.display="none";
        alert("Admin Panel freigeschaltet!");
    } else alert("Falscher Code!");
}

window.checkLogCode = function() {
    if (document.getElementById("logCode").value===LOG_PASSWORD) {
        const panel = document.getElementById("adminPlusPanel"); 
        panel.style.display="block"; 
        setTimeout(()=>panel.classList.add("show"),10);
        document.getElementById("logCodeInput").style.display="none"; 
        updateAdminLog(); 
        alert("Versionsverlauf freigeschaltet!");
    } else alert("Falscher Code!");
}

window.addVehicle = async function() {
    const name = document.getElementById("vehicleName").value.trim();
    const year = document.getElementById("vehicleYear").value.trim();
    const description = document.getElementById("vehicleDescription").value.trim();
    const img = document.getElementById("vehicleImage").value || "https://imgur.com/HkCAjLw.png";
    const cat = document.getElementById("vehicleCategory").value;
    if (!name || !year) { alert("Bitte Name und Baujahr angeben!"); return; }
    if (!vehiclesData[cat]) vehiclesData[cat] = [];
    vehiclesData[cat].push({ name, year, description, img });
    adminLog.push({ action: "hinzugefügt", name, category: cat, by: "Admin", timestamp: new Date() });
    renderVehicles(); updateAdminLog(); updateRemoveVehicles();
    document.getElementById("vehicleName").value = ""; 
    document.getElementById("vehicleYear").value = "";
    document.getElementById("vehicleDescription").value = ""; 
    document.getElementById("vehicleImage").value = "";
    if (!LOCAL_MODE) { await saveVehiclesGitHub("Fahrzeug hinzugefügt"); await saveLogGitHub("Log aktualisiert"); }
}

window.removeVehicle = async function() {
    const cat = document.getElementById("removeCategory").value;
    const idx = document.getElementById("removeVehicle").value;
    const by = document.getElementById("removedBy").value.trim();
    if(!by){ alert("Bitte gib an, wer das Fahrzeug entfernt!"); return; }
    if(cat && idx!==""){ 
        const removed = vehiclesData[cat][idx]; 
        vehiclesData[cat].splice(idx,1);
        adminLog.push({action:"entfernt",name:removed.name,category:cat,by,timestamp:new Date()});
        renderVehicles(); updateAdminLog(); updateRemoveVehicles(); document.getElementById("removedBy").value="";
        alert("Fahrzeug entfernt!");
        if(!LOCAL_MODE){ await saveVehiclesGitHub("Fahrzeug entfernt"); await saveLogGitHub("Log aktualisiert"); }
    } else alert("Bitte Kategorie und Fahrzeug wählen.");
}

window.updateRemoveVehicles = function(){
    const cat = document.getElementById("removeCategory").value;
    const sel = document.getElementById("removeVehicle"); sel.innerHTML="<option value=''>Fahrzeug wählen</option>";
    if(cat && vehiclesData[cat]) vehiclesData[cat].forEach((v,i)=>{ const opt=document.createElement("option"); opt.value=i; opt.textContent=v.name; sel.appendChild(opt); });
}

window.clearAdminLog = async function() {
    if(confirm("Möchtest du wirklich den gesamten Versionsverlauf löschen?")){
        adminLog=[]; updateAdminLog();
        const panel = document.getElementById("adminPlusPanel"); panel.classList.remove("show"); setTimeout(()=>panel.style.display="none",500);
        if(!LOCAL_MODE) await saveLogGitHub("Versionsverlauf gelöscht");
        alert("Versionsverlauf gelöscht!");
    }
}

// ------------------- INITIAL -------------------
(async () => {
    await loadVehicles();
    await loadLog();
})();
</script>
